---
- name: Creating a user named {{ username }} on the specified web server.
  user: 
    name: "{{ username }}"
    # password: "{{ hashed_password }}"
    state: present
    shell: /bin/zsh
    groups:
    - sudo
    - docker
    - "{{ username }}"
    - microk8s
    - lxd
    - docker
    append: yes
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: /home/{{ username }}/.ssh/id_rsa

# - name: Copy .ssh/id_rsa from host box to the remote box for user {{ username }}
#   become: true
#   copy: 
#     src: ~/.ssh/id_rsa.pub
#     dest: /home/{{ username }}/.ssh/authorized_keys
#     mode: 0600
#     owner: "{{ username }}"
#     group: "{{ username }}"

- name: Add user to sudoers list
  lineinfile:
    dest: /etc/sudoers
    regexp: "{{ username }} ALL"
    line: "{{ username }} ALL=(ALL) ALL"
    state: present